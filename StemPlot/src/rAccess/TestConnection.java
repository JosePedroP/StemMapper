package rAccess;

import org.rosuda.REngine.REXP;
import org.rosuda.REngine.Rserve.RConnection;

import rAccess.RAccess;

//R CMD Rserve
//ps ax|grep Rserve

public class TestConnection {

	public static void main(String[] args) {
		
//		System.out.println(RAccess.isRserveRunning());
		System.out.println(RAccess.checkLocalRserve("/usr/lib/R"));
//		System.out.println(StartRserve.checkLocalRserve("/usr/lib/R"));
		
		String data = "setwd(\"/home/jose/phb/diffIdTest/heatmapTest/ProcessedData\");";
		data += "allValues <- data.matrix(read.table(\"combinedData.csv\", sep=\"\\t\", row.names=1, header=T));";
		data += "markers <- c(\"58235\",\"52906\",\"67865\",\"74884\",\"100415901\",\"170788\",\"23834\",\"71532\",\"18023\",\"16622\",\"70120\",\"268729\",\"68644\",\"217653\",\"20317\",\"243043\",\"110606\",\"211936\",\"192119\",\"12212\",\"65961\",\"17695\",\"97890\",\"73430\",\"68611\",\"269473\",\"382089\",\"72580\",\"74195\",\"14784\",\"66464\",\"29870\",\"64406\",\"14149\",\"97810\",\"75328\",\"20191\",\"71121\",\"66790\",\"320329\",\"50917\",\"67967\",\"18475\",\"241447\",\"12562\",\"56068\",\"19296\",\"60527\",\"216549\",\"233726\",\"56705\",\"75616\",\"74452\",\"100504527\",\"56378\",\"74134\",\"74762\",\"52458\",\"228368\",\"74641\",\"225923\",\"230661\",\"74628\",\"68473\",\"99811\",\"21379\",\"12455\",\"28081\",\"70382\",\"109212\",\"234384\",\"21771\",\"381716\",\"97787\",\"68011\",\"102693\",\"226419\",\"622175\",\"69923\",\"13510\",\"21849\",\"12950\",\"98108\",\"11944\",\"100504504\",\"402737\",\"73438\",\"232947\",\"75477\",\"18125\",\"100503546\",\"106794\",\"29863\",\"72053\",\"76998\",\"97008\",\"20962\",\"66905\",\"70122\",\"243300\",\"72361\",\"76968\",\"19821\",\"140629\",\"53424\",\"67005\",\"18609\",\"101685\",\"78279\",\"109689\",\"12902\",\"76835\",\"70609\",\"69857\",\"23880\",\"13191\",\"30838\",\"77250\",\"16969\",\"67102\",\"70691\",\"97129\",\"213575\",\"19668\",\"233058\",\"70021\",\"76710\",\"76688\",\"27376\",\"94279\",\"12371\",\"70872\",\"16542\",\"56184\",\"380686\",\"13650\",\"209737\",\"14405\",\"76626\",\"71027\",\"75510\",\"67838\",\"21951\",\"22341\",\"433700\",\"16163\",\"69638\",\"23948\",\"22346\",\"77697\",\"72107\",\"102685\",\"19725\",\"72017\",\"113863\",\"67330\",\"100502619\",\"102634692\",\"74744\",\"26903\",\"14629\",\"329628\",\"66880\",\"54519\",\"234362\",\"20729\",\"100604\",\"20348\",\"664883\",\"96953\",\"22688\",\"18716\",\"71251\",\"13138\",\"224139\",\"227099\",\"102626\",\"13685\",\"67045\",\"332397\",\"13542\",\"235323\",\"217331\",\"211986\",\"71046\",\"403205\",\"552913\",\"14866\",\"100040529\",\"320211\",\"319622\",\"17962\",\"403348\",\"228061\",\"171167\",\"140780\",\"16196\",\"24059\",\"66596\",\"208890\",\"15959\",\"13690\",\"12144\",\"268534\",\"66113\",\"69234\",\"20383\",\"320244\",\"102209\",\"67199\",\"65254\",\"20496\",\"76893\",\"53356\",\"209012\",\"245865\",\"170439\",\"226594\",\"11872\",\"70381\",\"52480\",\"20355\",\"12488\",\"56222\",\"100038680\",\"75308\",\"12686\",\"70350\",\"75725\",\"215008\",\"217847\",\"83554\",\"100041694\",\"105518\",\"218581\",\"17986\",\"68054\",\"72149\",\"12449\",\"216456\",\"211007\",\"100215\",\"17451\",\"73186\",\"68002\",\"12549\",\"330427\",\"12877\",\"216169\",\"320702\",\"114606\",\"234967\",\"69677\",\"209200\",\"74499\",\"269514\",\"19128\",\"12477\",\"13110\",\"52490\",\"51953\",\"320472\",\"71777\",\"109245\",\"67578\",\"242083\",\"100039495\",\"67905\",\"14789\",\"105592\",\"69350\",\"77132\",\"246278\",\"320581\",\"73062\",\"231532\",\"228875\",\"228880\",\"66244\",\"71575\",\"235533\",\"53312\",\"226541\",\"433619\",\"327768\",\"69136\",\"26941\",\"50927\",\"18671\",\"54122\",\"234964\",\"105171\",\"59004\",\"243931\",\"244091\",\"329387\",\"20964\",\"14114\",\"18484\",\"18416\",\"15207\",\"27277\",\"19053\",\"14407\",\"320158\",\"67425\",\"18012\",\"106894\",\"235106\",\"277468\",\"20429\",\"225280\",\"380794\",\"213582\",\"14420\",\"85031\",\"226896\");";

		data += "tab <- allValues;";
		data += "tab<-subset(tab, rownames(tab) %in% markers);";
		data += "tab<-t(tab);";
		data += "log.ir <- log(tab);";
		data += "ir.pca <- prcomp(log.ir, center = TRUE, scale. = TRUE);"; 
		
		data += "scores = as.data.frame(ir.pca$x);";
		data += "mdat <- matrix(c(scores$PC1, scores$PC2), nrow = 2, ncol = length(scores$PC1));";
		data += "mdat;";
		
		try{
			RConnection c = new RConnection();
			
			REXP x = c.eval(data);

//			System.out.println(x.asString());
//			
//			double[] dobm = x.asDoubles();
//			
//			System.out.println(dobm[0]);
//			System.out.println(dobm[1]);
			
			double[][] dobm = x.asDoubleMatrix();
			

			System.out.println(dobm.length);
			System.out.println(dobm[0].length);
			
			System.out.println(dobm[0][0]);
			System.out.println(dobm[0][1]);
			
			data = "rownames(tab);";
			
			x = c.eval(data);
			
			String[] names = x.asStrings();
			
			System.out.println(names[0]);
			
			c.close();
		} catch(Exception e)
		{e.printStackTrace();}
		
	}
	
}
